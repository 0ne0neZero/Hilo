/**
 * Hilo 1.0.2 for cmd
 * Copyright 2016 alibaba.com
 * Licensed under the MIT License
 */
define(function(e,t,n){var r=e("hilo/core/Hilo"),i=e("hilo/core/Class"),s=e("hilo/view/Container"),a=e("hilo/renderer/CanvasRenderer"),o=e("hilo/renderer/DOMRenderer"),h=e("hilo/renderer/WebGLRenderer"),d=i.create({Extends:s,constructor:function(e){e=e||{},this.id=this.id||e.id||r.getUid("Stage"),d.superclass.constructor.call(this,e),this._initRenderer(e);var t=this.width,n=this.height,i=this.updateViewport();e.width||(t=i&&i.width||320),e.height||(n=i&&i.height||480),this.resize(t,n,!0)},canvas:null,renderer:null,paused:!1,viewport:null,_initRenderer:function(e){var t=e.canvas,n=e.container,i=e.renderType||"canvas";if("string"==typeof t&&(t=r.getElement(t)),"string"==typeof n&&(n=r.getElement(n)),t)t.getContext||(i="dom");else{var s="dom"===i?"div":"canvas";t=r.createElement(s,{style:{position:"absolute"}})}this.canvas=t,n&&n.appendChild(t);var d={canvas:t,stage:this};switch(i){case"dom":this.renderer=new o(d);break;case"webgl":h.isSupport()?this.renderer=new h(d):this.renderer=new a(d);break;case"canvas":default:this.renderer=new a(d)}},addTo:function(e){var t=this.canvas;return t.parentNode!==e&&e.appendChild(t),this},tick:function(e){this.paused||this._render(this.renderer,e)},enableDOMEvent:function(e,t){var n=this,r=n.canvas,i=n._domListener||(n._domListener=function(e){n._onDOMEvent(e)});e="string"==typeof e?[e]:e,t=t!==!1;for(var s=0;s<e.length;s++){var a=e[s];t?r.addEventListener(a,i,!1):r.removeEventListener(a,i)}return n},_onDOMEvent:function(e){var t=e.type,n=e,i=0==t.indexOf("touch"),s=e;if(i){var a=e.touches,o=e.changedTouches;s=a&&a.length?a[0]:o&&o.length?o[0]:null}var h=s.pageX||s.clientX,d=s.pageY||s.clientY,c=this.viewport||this.updateViewport();n.stageX=h=(h-c.left)/this.scaleX,n.stageY=d=(d-c.top)/this.scaleY,n.stopPropagation=function(){this._stopPropagationed=!0};var u=this.getViewAtPoint(h,d,!0,!1,!0)||this,v=this.canvas,l=this._eventTarget,p="mouseout"===t;if(l&&(l!=u&&(!l.contains||!l.contains(u))||p)){var g="touchmove"===t?"touchout":"mousemove"===t||p||!u?"mouseout":null;if(g){var f=r.copy({},n);f.type=g,f.eventTarget=l,l._fireMouseEvent(f)}n.lastEventTarget=l,this._eventTarget=null}if(u&&u.pointerEnabled&&"mouseout"!==t&&(n.eventTarget=this._eventTarget=u,u._fireMouseEvent(n)),!i){var w=u&&u.pointerEnabled&&u.useHandCursor?"pointer":"";v.style.cursor=w}r.browser.android&&"touchmove"===t&&e.preventDefault()},updateViewport:function(){var e=this.canvas,t=null;return e.parentNode&&(t=this.viewport=r.getElementRect(e)),t},resize:function(e,t,n){(n||this.width!==e||this.height!==t)&&(this.width=e,this.height=t,this.renderer.resize(e,t),this.updateViewport())}});return d});